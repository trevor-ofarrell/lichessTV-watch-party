{"ast":null,"code":"import _slicedToArray from\"/home/d9/code/lichessTV-watch-party/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _styled from\"@emotion/styled\";import React,{useRef,useState,useEffect}from\"react\";import Chessboard from\"chessboardjsx\";import useChat from\"./useChat\";import useTyping from\"./useTyping\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Input=_styled.input({\"paddingLeft\":\"1rem\",\"paddingRight\":\"1rem\",\"paddingTop\":\"0.5rem\",\"paddingBottom\":\"0.5rem\",\"::placeholder\":{\"--tw-placeholder-opacity\":\"1\",\"color\":\"rgba(160, 174, 192, var(--tw-placeholder-opacity))\"},\"width\":\"auto\",\":focus\":{\"--tw-ring-opacity\":\"1\",\"--tw-ring-color\":\"rgba(162, 115, 255, var(--tw-ring-opacity))\",\"--tw-border-opacity\":\"1\",\"borderColor\":\"rgba(100, 21, 255, var(--tw-border-opacity))\"},\"--tw-border-opacity\":\"1\",\"borderColor\":\"rgba(203, 213, 224, var(--tw-border-opacity))\",\"borderWidth\":\"1px\",\"borderStyle\":\"solid\",\"borderRadius\":\"0.375rem\",\"--tw-shadow\":\"0 0 0 1px rgba(0, 0, 0, 0.05)\",\"boxShadow\":\"var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)\",\"@media (min-width: 1024px)\":{\"marginLeft\":\"auto\",\"marginRight\":\"auto\"}});export var InputTextLeft=_styled(Input)({\"textAlign\":\"left\",\"paddingTop\":\"0.5rem\",\"paddingBottom\":\"0.5rem\"});var getWindowDimensions=function getWindowDimensions(){var _window=window,width=_window.innerWidth,height=_window.innerHeight;return{width:width,height:height};};var useWindowDimensions=function useWindowDimensions(){var _useState=useState(getWindowDimensions()),_useState2=_slicedToArray(_useState,2),windowDimensions=_useState2[0],setWindowDimensions=_useState2[1];useEffect(function(){function handleResize(){setWindowDimensions(getWindowDimensions());}window.addEventListener(\"resize\",handleResize);return function(){return window.removeEventListener(\"resize\",handleResize);};},[]);return windowDimensions;};var Room=function Room(props){var roomId=props.roomId,name=props.name;var _useTyping=useTyping(),isTyping=_useTyping.isTyping,startTyping=_useTyping.startTyping,stopTyping=_useTyping.stopTyping,cancelTyping=_useTyping.cancelTyping;var _useWindowDimensions=useWindowDimensions(),height=_useWindowDimensions.height,width=_useWindowDimensions.width;var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),newMessage=_useState4[0],setNewMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),gameID=_useState6[0],setGameID=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),FEN=_useState8[0],setFEN=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),black=_useState10[0],setBlack=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),white=_useState12[0],setWhite=_useState12[1];var messageRef=useRef();var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),listening=_useState14[0],setListening=_useState14[1];var _useChat=useChat(roomId,name),messages=_useChat.messages,user=_useChat.user,users=_useChat.users,typingUsers=_useChat.typingUsers,sendMessage=_useChat.sendMessage,startTypingMessage=_useChat.startTypingMessage,stopTypingMessage=_useChat.stopTypingMessage,addUser=_useChat.addUser;var handleNewMessageChange=function handleNewMessageChange(event){setNewMessage(event.target.value);};var handleSendMessage=function handleSendMessage(event){event.preventDefault();cancelTyping();if(newMessage!==\"\"){sendMessage(newMessage,false);setNewMessage(\"\");}};var handleKeyUp=function handleKeyUp(event){if(event.key===\"Enter\"){if(newMessage!==\"\"){sendMessage(newMessage,false);setNewMessage(\"\");}}};var createPlayerNames=function createPlayerNames(user,setPlayer){var username=\"\";if(user.user.name){if(user.user.title){username=user.user.title+\" \"+user.user.name+\" \"+user.rating;}else{username=user.user.name+\" \"+user.rating;}setPlayer(username);}};var selectRandomColor=function selectRandomColor(){colors=['text-green-400','text-purple-400','text-pink-400','text-red-400','text-blue-400','text-orange-400'];return colors[Math.floor(Math.random()*colors.length)];};useEffect(function(){return messageRef.current.scrollIntoView({behavior:\"smooth\"});});useEffect(function(){if(!listening){var source;roomId!==\"featured\"?source=new EventSource(\"\".concat(process.env.REACT_APP_API_ENDPOINT,\"/lichesstvcustom/?id=\").concat(roomId)):source=new EventSource(\"\".concat(process.env.REACT_APP_API_ENDPOINT,\"/lichesstv\"));if(roomId!==\"featured\"){source.onmessage=function(event){var parsedData=JSON.parse(event.data);//console.log(event.data);\nsetFEN([parsedData.fen]);if(parsedData.id){setGameID(parsedData.id);}};}else{source.onmessage=function(event){var parsedData=JSON.parse(event.data);console.log(event.data);setFEN([parsedData.d.fen]);if(parsedData.d.players){createPlayerNames(parsedData.d.players[0],setWhite);createPlayerNames(parsedData.d.players[1],setBlack);}if(parsedData.d.id){setGameID(parsedData.d.id);}};}setListening(true);}},[listening,FEN]);useEffect(function(){if(isTyping)startTypingMessage();else stopTypingMessage();},[isTyping]);return/*#__PURE__*/_jsx(\"div\",{style:{height:height,width:width},className:\"ml-auto bg-black overflow-hidden\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"h-full max-h-full flex flex-col xl:items-stretch xl:flex-row overflow-hidden\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"/\",className:\"md:left-4 md:top-4 left-2 top-2 absolute md:pr-6 hidden md:flex\",children:/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"md:h-10 md:w-10 h-8 w-8 text-white\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:2,d:\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"sm:mt-auto overflow-hidden m-auto mt-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex md:mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex mr-auto p-2 pl-0\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"md:text-xl text-sm text-white pr-1\",children:\"game:\"}),/*#__PURE__*/_jsxs(\"a\",{href:\"https://lichess.org/\".concat(gameID),className:\"md:text-xl text-sm text-white\",children:[\"lichess.org/\",gameID]})]}),/*#__PURE__*/_jsxs(\"h1\",{className:\"md:text-xl text-sm text-white p-2 m-auto\",children:[\"room: \",roomId]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium md:text-sm md:pl-0 text-xs pl-6 text-white max-w-50% text-left break-all hidden md:flex\",children:[\"FEN: \",FEN]}),/*#__PURE__*/_jsxs(\"div\",{className:\"m-auto\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium md:text-2xl text-lg my-1 text-white\",children:black}),/*#__PURE__*/_jsx(\"div\",{className:\"m-auto\",children:/*#__PURE__*/_jsx(Chessboard,{position:FEN[0],transitionDuration:100,showNotation:false,calcWidth:function calcWidth(size){return size.screenWidth<1440?size.screenHeight/100*46:size.screenWidth>1440?size.screenHeight/100*70:screen.width/100*100;}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"font-medium md:text-2xl text-lg my-1 text-white\",children:[\" \",white]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"rounded-lg h-full xl:w-2/6 xl:max-h-full max-h-4/12 w-full max-w-full xl:max-w-2/6 pb-14 bg-black ml-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"h-full ml-1 mt-1 overflow-y-auto\",children:[/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"ol\",{children:messages.map(function(message,i){return/*#__PURE__*/_jsx(\"li\",{children:message.system===true?/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-gray-500 text-sm\",children:message.body}):/*#__PURE__*/_jsxs(\"span\",{className:\"text-left text-white text-sm flex\",children:[message.name?/*#__PURE__*/_jsxs(\"div\",{className:\"font-bold \".concat(message.user.color,\" mr-1\"),children:[message.name,\":\"]}):/*#__PURE__*/_jsx(_Fragment,{children:\"\"}),message.body]})},i);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"xl:w-30% px-auto w-99 bottom-1 absolute\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"w-full h-10 pl-3 pr-8 text-base placeholder-white-600 border bg-gray-700 rounded-lg focus:shadow-outline\",id:\"message\",type:\"text\",label:\"Message\",placeholder:\"enter message here\",variant:\"outlined\",value:newMessage,onChange:handleNewMessageChange,onKeyUp:handleKeyUp}),/*#__PURE__*/_jsx(\"button\",{className:\"absolute inset-y-0 h-10 right-0 flex items-center px-4 font-bold text-white bg-yellow-600 rounded-r-lg hover:bg-blue-500\",disabled:!newMessage,variant:\"contained\",color:\"primary\",onClick:handleSendMessage,children:\"Send\"})]})]}),/*#__PURE__*/_jsx(\"div\",{ref:messageRef})]})})]})});};export default Room;","map":{"version":3,"sources":["/home/d9/code/lichessTV-watch-party/client/src/Room.jsx"],"names":["React","useRef","useState","useEffect","Chessboard","useChat","useTyping","Input","tw","input","InputTextLeft","getWindowDimensions","window","width","innerWidth","height","innerHeight","useWindowDimensions","windowDimensions","setWindowDimensions","handleResize","addEventListener","removeEventListener","Room","props","roomId","name","isTyping","startTyping","stopTyping","cancelTyping","newMessage","setNewMessage","gameID","setGameID","FEN","setFEN","black","setBlack","white","setWhite","messageRef","listening","setListening","messages","user","users","typingUsers","sendMessage","startTypingMessage","stopTypingMessage","addUser","handleNewMessageChange","event","target","value","handleSendMessage","preventDefault","handleKeyUp","key","createPlayerNames","setPlayer","username","title","rating","selectRandomColor","colors","Math","floor","random","length","current","scrollIntoView","behavior","source","EventSource","process","env","REACT_APP_API_ENDPOINT","onmessage","parsedData","JSON","parse","data","fen","id","console","log","d","players","size","screenWidth","screenHeight","screen","map","message","i","system","body","color"],"mappings":"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","sourcesContent":["import React, { useRef, useState, useEffect } from \"react\";\nimport Chessboard from \"chessboardjsx\";\nimport tw from \"twin.macro\";\nimport useChat from \"./useChat\";\nimport useTyping from \"./useTyping\";\n\nexport const Input = tw.input`\n  px-4\n  py-2\n  placeholder-gray-500\n  w-auto\n  lg:mx-auto\n  focus:ring-primary-100\n  focus:border-primary-500\n  border-gray-400\n  border-width[1px]\n  border-solid\n  rounded-md\n  shadow-xs\n`;\n\nexport const InputTextLeft = tw(Input)`text-left py-2`;\n\nconst getWindowDimensions = () => {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height,\n  };\n};\n\nconst useWindowDimensions = () => {\n  const [windowDimensions, setWindowDimensions] = useState(\n    getWindowDimensions()\n  );\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener(\"resize\", handleResize);\n    return () => window.removeEventListener(\"resize\", handleResize);\n  }, []);\n\n  return windowDimensions;\n};\n\nconst Room = (props) => {\n  const { roomId, name } = props;\n  const { isTyping, startTyping, stopTyping, cancelTyping } = useTyping();\n  const { height, width } = useWindowDimensions();\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [gameID, setGameID] = useState(\"\");\n  const [FEN, setFEN] = useState([]);\n  const [black, setBlack] = useState(\"\");\n  const [white, setWhite] = useState(\"\");\n  const messageRef = useRef();\n  const [listening, setListening] = useState(false);\n  const {\n    messages,\n    user,\n    users,\n    typingUsers,\n    sendMessage,\n    startTypingMessage,\n    stopTypingMessage,\n    addUser,\n  } = useChat(roomId, name);\n\n  const handleNewMessageChange = (event) => {\n    setNewMessage(event.target.value);\n  };\n\n  const handleSendMessage = (event) => {\n    event.preventDefault();\n    cancelTyping();\n    if (newMessage !== \"\") {\n      sendMessage(newMessage, false);\n      setNewMessage(\"\");\n    }\n  };\n\n  const handleKeyUp = (event) => {\n    if (event.key === \"Enter\") {\n      if (newMessage !== \"\") {\n        sendMessage(newMessage, false);\n        setNewMessage(\"\");\n      }\n    }\n  };\n\n  const createPlayerNames = (user, setPlayer) => {\n    let username = \"\";\n    if (user.user.name) {\n      if (user.user.title) {\n        username = user.user.title + \" \" + user.user.name + \" \" + user.rating;\n      } else {\n        username = user.user.name + \" \" + user.rating;\n      }\n      setPlayer(username);\n    }\n  };\n\n  const selectRandomColor = () => {\n    colors = [\n      'text-green-400',\n      'text-purple-400',\n      'text-pink-400',\n      'text-red-400',\n      'text-blue-400',\n      'text-orange-400',\n    ]\n    return colors[Math.floor(Math.random() * colors.length)];\n  }\n\n  useEffect(() => messageRef.current.scrollIntoView({ behavior: \"smooth\" }));\n\n  useEffect(() => {\n    if (!listening) {\n      let source;\n      roomId !== \"featured\"\n        ? (source = new EventSource(\n            `${process.env.REACT_APP_API_ENDPOINT}/lichesstvcustom/?id=${roomId}`\n          ))\n        : (source = new EventSource(\n            `${process.env.REACT_APP_API_ENDPOINT}/lichesstv`\n          ));\n      if (roomId !== \"featured\") {\n        source.onmessage = (event) => {\n          const parsedData = JSON.parse(event.data);\n          //console.log(event.data);\n          setFEN([parsedData.fen]);\n          if (parsedData.id) {\n            setGameID(parsedData.id);\n          }\n        };\n      } else {\n        source.onmessage = (event) => {\n          const parsedData = JSON.parse(event.data);\n          console.log(event.data);\n          setFEN([parsedData.d.fen]);\n          if (parsedData.d.players) {\n            createPlayerNames(parsedData.d.players[0], setWhite);\n            createPlayerNames(parsedData.d.players[1], setBlack);\n          }\n          if (parsedData.d.id) {\n            setGameID(parsedData.d.id);\n          }\n        };\n      }\n      setListening(true);\n    }\n  }, [listening, FEN]);\n\n  useEffect(() => {\n    if (isTyping) startTypingMessage();\n    else stopTypingMessage();\n  }, [isTyping]);\n\n  return (\n    <div\n      style={{ height: height, width: width }}\n      className=\"ml-auto bg-black overflow-hidden\"\n    >\n      <div className=\"h-full max-h-full flex flex-col xl:items-stretch xl:flex-row overflow-hidden\">\n        <a href=\"/\" className=\"md:left-4 md:top-4 left-2 top-2 absolute md:pr-6 hidden md:flex\">\n          <svg\n            xmlns=\"http://www.w3.org/2000/svg\"\n            className=\"md:h-10 md:w-10 h-8 w-8 text-white\"\n            fill=\"none\"\n            viewBox=\"0 0 24 24\"\n            stroke=\"currentColor\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6\"\n            />\n          </svg>\n        </a>\n        <div className=\"sm:mt-auto overflow-hidden m-auto mt-0\">\n          <div className=\"flex md:mt-2\">\n            <div className=\"flex mr-auto p-2 pl-0\">\n              <h1 className=\"md:text-xl text-sm text-white pr-1\">game:</h1>\n              <a\n                href={`https://lichess.org/${gameID}`}\n                className=\"md:text-xl text-sm text-white\"\n              >\n                lichess.org/{gameID}\n              </a>\n            </div>\n            <h1 className=\"md:text-xl text-sm text-white p-2 m-auto\">\n              room: {roomId}\n            </h1>\n          </div>\n          <div className=\"font-medium md:text-sm md:pl-0 text-xs pl-6 text-white max-w-50% text-left break-all hidden md:flex\">\n            FEN: {FEN}\n          </div>\n          <div className=\"m-auto\">\n            <div className=\"font-medium md:text-2xl text-lg my-1 text-white\">\n              {black}\n            </div>\n            <div className=\"m-auto\">\n              <Chessboard\n                position={FEN[0]}\n                transitionDuration={100}\n                showNotation={false}\n                calcWidth={(size) =>\n                  size.screenWidth < 1440\n                    ? (size.screenHeight / 100) * 46\n                    : size.screenWidth > 1440\n                    ? (size.screenHeight / 100) * 70\n                    : (screen.width / 100) * 100\n                }\n              />\n            </div>\n            <div className=\"font-medium md:text-2xl text-lg my-1 text-white\">\n              {\" \"}\n              {white}\n            </div>\n          </div>\n        </div>\n        <div className=\"rounded-lg h-full xl:w-2/6 xl:max-h-full max-h-4/12 w-full max-w-full xl:max-w-2/6 pb-14 bg-black ml-auto\">\n          <div className=\"h-full ml-1 mt-1 overflow-y-auto\">\n            <>\n              <ol>\n                {messages.map((message, i) => (\n                  <li key={i}>\n                    {message.system === true ? (\n                      <div className=\"text-center text-gray-500 text-sm\">\n                        {message.body}\n                      </div>\n                    ) : (\n                      <span className=\"text-left text-white text-sm flex\">\n                        {message.name ? (\n                          <div className={`font-bold ${message.user.color} mr-1`}>\n                            {message.name}:\n                          </div>\n                        ) : (\n                          <>{\"\"}</>\n                        )}\n                        {message.body}\n                      </span>\n                    )}\n                  </li>\n                ))}\n              </ol>\n              <div className=\"xl:w-30% px-auto w-99 bottom-1 absolute\">\n                <input\n                  className=\"w-full h-10 pl-3 pr-8 text-base placeholder-white-600 border bg-gray-700 rounded-lg focus:shadow-outline\"\n                  id=\"message\"\n                  type=\"text\"\n                  label=\"Message\"\n                  placeholder=\"enter message here\"\n                  variant=\"outlined\"\n                  value={newMessage}\n                  onChange={handleNewMessageChange}\n                  onKeyUp={handleKeyUp}\n                />\n                <button\n                  className=\"absolute inset-y-0 h-10 right-0 flex items-center px-4 font-bold text-white bg-yellow-600 rounded-r-lg hover:bg-blue-500\"\n                  disabled={!newMessage}\n                  variant=\"contained\"\n                  color=\"primary\"\n                  onClick={handleSendMessage}\n                >\n                  Send\n                </button>\n              </div>\n            </>\n            <div ref={messageRef}></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Room;\n"]},"metadata":{},"sourceType":"module"}